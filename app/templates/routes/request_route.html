{% extends "base.html" %}
{% import "map.html" as map %}
{% import "datepicker.html" as dtpick %}

{% block imports %}
    {{ map.imports() }}
    {{ dtpick.imports() }}
{% endblock %}


{% block styles %}
    #mapid {
    height: 100%;
    }
{% endblock %}

{% block body %}
    <section class="section">
        <div class="columns">
            <div class="column">
                {{ map.map() }}
            </div>
            <form action="" class="column" method="POST" novalidate>
                <div class="tile is-vertical">
                    {{ form.hidden_tag() }}
                    <h1 class="title">Ride with {{ user.firstname }}!</h1>
                    <div class="columns">
                        <div class="column">
                            <h2 class="subtitle">Trip information</h2>
                            <p> From: {{ trip.text_from() }}</p>
                            <p> To: {{ trip.text_to() }} </p>
                            <p> Time: {{ trip.departure_time }} </p><br><br>
                            {% if trip.playlist %}
                            <p>Here is the playlist that was added to the route.</p><br>
                            <iframe src="https://open.spotify.com/embed/playlist/{{ trip.playlist }}" width="80%" height="80%" frameborder="10" allowtransparency="true" allow="encrypted-media"></iframe>
                            {% elif range(0, 10) | random%}
                                <p>No playlist added to this route. </p>
                            <p>Here is some other music to cheer you up.</p><br>
                                <iframe src="https://open.spotify.com/embed/playlist/2MClsgoo2g1jaWfshyduRL?" uri="theme=white" width="80%" height="80%" frameborder="10" allowtransparency="true" allow="encrypted-media"></iframe>
                            {% else %}
                                <p>No playlist added to this route. </p>
                            <p>Here is some other music, hehep.</p><br>
                                <iframe src="https://open.spotify.com/embed/album/6N9PS4QXF1D0OWPk0Sxtb4" width="80%" height="80%" frameborder="10" allowtransparency="true" allow="encrypted-media"></iframe>
                            {% endif %}
                        </div>
                        <div class="column">
                            <div class="columns">
                                <div class="column">
                                    <h2 class="subtitle">Driver information</h2>
                                    <figure class="image is-128x128">
                                        <img class="is-rounded" src="{{ user.avatar(128) }}">
                                    </figure>
                                    <br>
                                    <p> Name: {{ user.firstname }} {{ user.lastname }} </p>
                                    <p> email: {{ user.email }} </p>
                                    <a class="button" href="{{ url_for('users.user_page',  username=user.username) }}">More
                                        info</a>
                                </div>
                                <div class="column">
                                    <h2 class="subtitle">Passengers information</h2>
                                    {% if passengers %}
                                        {% for passenger in passengers %}
                                            <figure class="image is-128x128">
                                                <img class="is-rounded" src="{{ passenger.avatar(128) }}">
                                            </figure>
                                            <br>
                                            <p> Name: {{ passenger.firstname }} {{ passenger.lastname }} </p>
                                            <p> email: {{ passenger.email }} </p>
                                            <a class="button"
                                               href="{{ url_for('users.user_page',  username=passenger.username) }}">More
                                                info</a>
                                        {% endfor %}
                                    {% else %}
                                        <div>
                                            <strong>No passengers</strong>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <br><br>
                    {% if not isdriver %}
                        <div class="buttons">
                            {% if requested %}
                                <button class="button is-primary" href="{{ url_for('routes_drive.cancel_request', drive_id=trip.id) }}">Cancel request</button>
                            {% else %}
                                {{ form.submit(class="button is-primary") }}
                            {% endif %}
                        </div>
                    {% else %}
                        <div class="buttons">
                            <a class="button is-primary" href="{{ url_for('routes_drive.editRoute', id=trip.id) }}">Edit</a>
                            <a class="button is-danger" href="{{ url_for('routes_drive.delete', id=trip.id) }}">Delete</a>
                        </div>
                    {% endif %}
                </div>
            </form>
        </div>
    </section>
{% endblock %}